#!/bin/bash

# This script automates fetching PokÃ©mon data and handles success or failure.

POKEMON_NAME="pikachu"
API_URL="https://pokeapi.co/api/v2/pokemon/${POKEMON_NAME}"
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

# Make the API request and capture the HTTP status code
HTTP_STATUS=$(curl -s -w "%{http_code}" -o "$OUTPUT_FILE" "$API_URL")

# Check if the request was successful (HTTP status 200)
if [ "$HTTP_STATUS" -eq 200 ]; then
  echo "Successfully retrieved data for $POKEMON_NAME and saved to $OUTPUT_FILE"
  # Clean up error file if it exists from a previous run
  [ -f "$ERROR_FILE" ] && rm "$ERROR_FILE"
else
  # Log the error and clean up the output file
  echo "Error: Failed to retrieve data for $POKEMON_NAME. HTTP Status: $HTTP_STATUS" > "$ERROR_FILE"
  # The output file might contain an error message from the API, so we keep it.
  # If it were guaranteed to be empty or garbage, we would rm it.
  # For this task, we'll overwrite data.json with the error message for clarity.
  mv "$OUTPUT_FILE" "$ERROR_FILE" 2>/dev/null || cat /dev/null > "$OUTPUT_FILE"
  echo "See $ERROR_FILE for details."
  exit 1
fi
